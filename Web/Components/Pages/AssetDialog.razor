@using  Application.DTO
@using System.ComponentModel.DataAnnotations
@using Domain.Entities
@using Application.Interfaces
@using MudBlazor
@using MudBlazor.Services
@using Microsoft.AspNetCore.Components
@using Microsoft.EntityFrameworkCore.Metadata.Internal
@rendermode InteractiveServer

@inject NavigationManager Navigation
@inject IAssetService AssetService
@inject ISnackbar Snackbar
@inject IDialogService DialogService


<MudDialog>
<DialogContent>
    <EditForm EditContext="_editContext" FormName="AssetDialogForm">
        <DataAnnotationsValidator />
        <MudGrid>
            <MudItem xs="12">
                <MudTextField Label="Name" @bind-Value="Model.Name" For="@(() => Model.Name)" />
            </MudItem>
            <MudItem xs="12">
                <MudTextField Label="Category" @bind-Value="Model.Category" For="@(() => Model.Category)" />
            </MudItem>
             <MudItem xs="12">
                <MudTextField Label="Current Value" @bind-Value="Model.CurrentValue" For="@(() => Model.CurrentValue)" />
            </MudItem>
            <MudItem xs="12">
                <MudTextField Label="Currency" @bind-Value="Model.Currency" For="@(() => Model.Currency)" />
            </MudItem>
             <MudItem xs="12">
                <MudTextField Label="Purchase Date" @bind-Value="Model.PurchaseDate" For="@(() => Model.PurchaseDate)" />
            </MudItem>
             <MudItem xs="12">
                <MudTextField Label="Purchase Value" @bind-Value="Model.PurchaseValue" For="@(() => Model.PurchaseValue)" />
            </MudItem>
             <MudItem xs="12">
                <MudTextField Label="Created At" @bind-Value="Model.CreatedAt" For="@(() => Model.CreatedAt)" />
            </MudItem>
             <MudItem xs="12">
                <MudTextField Label="Current Value" @bind-Value="Model.CurrentValue" For="@(() => Model.CurrentValue)" />
            </MudItem>
            
            <MudItem xs="12" class="d-flex justify-content-end">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="SubmitForm">Add Asset</MudButton>
            </MudItem>
        </MudGrid>

</EditForm>
</DialogContent>
</MudDialog>

@code{
    [CascadingParameter] IMudDialogInstance DialogInstance { get; set; } = default!;

    private AssetCreateDTO Model { get; set; } = new AssetCreateDTO();
    private EditContext? _editContext;
   


    protected override void OnInitialized()
    {
        _editContext = new EditContext(Model);
    }

    private void SubmitForm()
    {
        if (_editContext == null) return;
        try
        {
            if (_editContext.Validate())
            {
                AssetService.CreateAsset(Model);
                Snackbar.Add("Asset created successfully!", Severity.Success);
                DialogInstance.Close();
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Failed to create asset: {ex.Message}", Severity.Error);
        }
    }

}